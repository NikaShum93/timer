<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Редактор таймера</title>
  <style>
    body{
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background:#151524;
      color:#f5f5f5;
      margin:0;
      padding:20px;
    }
    h1{
      margin-top:0;
      margin-bottom:10px;
    }
    .panel{
      display:flex;
      gap:24px;
      align-items:flex-start;
      flex-wrap:wrap;
    }
    .controls{
      max-width:380px;
      padding:16px 18px;
      border-radius:12px;
      background:#22213a;
      box-shadow:0 0 20px #00000066;
    }
    .control-group{
      margin-bottom:10px;
    }
    .control-group label{
      display:block;
      font-size:0.9rem;
      margin-bottom:4px;
    }
    .control-group input[type="number"],
    .control-group input[type="text"],
    .control-group select{
      width:100%;
      padding:6px 8px;
      border-radius:6px;
      border:1px solid #555;
      background:#19182a;
      color:#f5f5f5;
      box-sizing:border-box;
    }
    .colors-row{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
    }
    .colors-row .control-group{
      flex:1 1 110px;
    }
    input[type="color"]{
      width:100%;
      height:32px;
      padding:0;
      border-radius:6px;
      border:1px solid #555;
      background:#19182a;
    }
    button{
      margin-top:8px;
      width:100%;
      padding:8px 10px;
      border-radius:8px;
      border:none;
      cursor:pointer;
      font-weight:600;
      background:#ff9900;
      color:#2b2440;
      box-shadow:0 0 15px #ff990088;
    }
    button:hover{
      filter:brightness(1.05);
    }
    .output{
      flex:1 1 360px;
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .output textarea{
      width:100%;
      min-height:360px;
      padding:10px;
      border-radius:10px;
      border:1px solid #555;
      background:#050513;
      color:#f5f5f5;
      font-family: "JetBrains Mono","Fira Code",monospace;
      font-size:0.85rem;
      box-sizing:border-box;
      resize:vertical;
    }
    .hint{
      font-size:0.85rem;
      color:#bbbbff;
    }
  </style>
</head>
<body>
  <h1>Редактор таймера (круг/квадрат)</h1>
  <p class="hint">1) Настрой параметры. 2) Нажми «Сгенерировать код». 3) Скопируй результат в Genially / iframe.</p>

  <div class="panel">
    <div class="controls">
      <div class="control-group">
        <label for="totalSeconds">Начальное время (секунды)</label>
        <input type="number" id="totalSeconds" value="30" min="1">
      </div>

      <div class="control-group">
        <label for="size">Размер виджета (px, ширина=высота)</label>
        <input type="number" id="size" value="180" min="60">
      </div>

      <div class="control-group">
        <label for="shape">Форма</label>
        <select id="shape">
          <option value="circle">Круг</option>
          <option value="square">Квадрат</option>
          <option value="rounded">Скруглённый квадрат</option>
        </select>
      </div>

      <div class="control-group" id="radiusGroup" style="display:none;">
        <label for="radius">Радиус скругления (px для скруглённого квадрата)</label>
        <input type="number" id="radius" value="24" min="0">
      </div>

      <div class="control-group">
        <label for="fontName">Шрифт Google Fonts (пример: Emilys Candy)</label>
        <input type="text" id="fontName" value="Emilys Candy">
      </div>

      <div class="colors-row">
        <div class="control-group">
          <label for="mainColor">Основной цвет прогресса</label>
          <input type="color" id="mainColor" value="#ff9900">
        </div>
        <div class="control-group">
          <label for="trackColor">Цвет «пустой» части</label>
          <input type="color" id="trackColor" value="#333333">
        </div>
      </div>

      <div class="colors-row">
        <div class="control-group">
          <label for="centerBg">Фон центра</label>
          <input type="color" id="centerBg" value="#2c2a4f">
        </div>
        <div class="control-group">
          <label for="textColor">Цвет цифр</label>
          <input type="color" id="textColor" value="#ffcc00">
        </div>
      </div>

      <div class="control-group">
        <label for="glowColor">Цвет свечения</label>
        <input type="color" id="glowColor" value="#ff9900">
      </div>

      <button id="generate">Сгенерировать код</button>
    </div>

    <div class="output">
      <label for="output">Готовый HTML-код таймера:</label>
      <textarea id="output" spellcheck="false"></textarea>
      <p class="hint">
        Вставь этот код в iframe / HTML-блок. При загрузке он сам запускает обратный отсчёт.<br>
        При желании можно отредактировать top/left и z-index у <code>.timer-widget-container</code>.
      </p>
    </div>
  </div>

  <script>
    const shapeSelect = document.getElementById('shape');
    const radiusGroup = document.getElementById('radiusGroup');

    shapeSelect.addEventListener('change', () => {
      radiusGroup.style.display = shapeSelect.value === 'rounded' ? 'block' : 'none';
    });

    function generateCode(){
      const totalSeconds = parseInt(document.getElementById('totalSeconds').value, 10) || 30;
      const size = parseInt(document.getElementById('size').value, 10) || 180;
      const shape = document.getElementById('shape').value;
      const radius = parseInt(document.getElementById('radius').value, 10) || 24;

      const fontName = (document.getElementById('fontName').value || 'Emilys Candy').trim();
      const fontParam = fontName.replace(/\s+/g, '+');

      const mainColor = document.getElementById('mainColor').value || '#ff9900';
      const trackColor = document.getElementById('trackColor').value || '#333333';
      const centerBg = document.getElementById('centerBg').value || '#2c2a4f';
      const textColor = document.getElementById('textColor').value || '#ffcc00';
      const glowColor = document.getElementById('glowColor').value || '#ff9900';

      let borderRadiusCSS = '50%';
      if (shape === 'square') {
        borderRadiusCSS = '0';
      } else if (shape === 'rounded') {
        borderRadiusCSS = radius + 'px';
      }

      const code = `
<div class="card-iframe">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=${fontParam}&display=swap" rel="stylesheet">

  <style>
    .timer-widget-container{
      width:${size}px; height:${size}px;
      position:fixed; top:30px; left:30px; z-index:1000;
      border-radius:${borderRadiusCSS};
      box-shadow:0 0 25px 12px ${glowColor}aa;
      overflow:visible;
    }
    .timer-progress{
      width:100%; height:100%; border-radius:${borderRadiusCSS};
      background-image: conic-gradient(${mainColor} 100%, ${trackColor} 0);
      display:flex; align-items:center; justify-content:center;
      transition: background-image 1s linear;
    }
    .timer-center-hole{
      width:85%; height:85%; border-radius:${borderRadiusCSS};
      background:${centerBg};
      box-shadow: inset 0 0 12px #00000099;
      display:flex; align-items:center; justify-content:center;
    }
    .timer-time-display{
      font-family:'${fontName}', cursive;
      font-size:3.5em; color:${textColor};
      text-shadow:0 0 6px ${glowColor};
      user-select:none;
    }
  </style>

  <div class="timer-widget-container">
    <div class="timer-progress" id="timer-progress-bar">
      <div class="timer-center-hole">
        <div class="timer-time-display" id="time-display">0:00</div>
      </div>
    </div>
  </div>

  <script>
    // === Настройки ===
    const initialTotalSeconds = ${totalSeconds}; // стартовое время (сек)

    // === Переменные ===
    let totalSeconds = initialTotalSeconds;
    let remainingSeconds = totalSeconds;
    let timerInterval = null;

    const progressDiv = document.getElementById('timer-progress-bar');
    const timeDisplay = document.getElementById('time-display');

    function formatTime(sec){
      const m = Math.floor(sec/60);
      const s = sec%60;
      return \`\${m}:\${s<10?'0':''}\${s}\`;
    }

    function updateDisplay(){
      timeDisplay.textContent = formatTime(remainingSeconds);
      const pct = (remainingSeconds/totalSeconds)*100;
      progressDiv.style.backgroundImage =
        \`conic-gradient(${mainColor} \${pct}%, ${trackColor} \${pct}%)\`;
    }

    function startCountdown(){
      clearInterval(timerInterval);
      timerInterval = setInterval(() => {
        if (remainingSeconds<=0){
          clearInterval(timerInterval);
          timerInterval=null;
          remainingSeconds=0;
          updateDisplay();
          return;
        }
        remainingSeconds--;
        updateDisplay();
      }, 1000);
    }

    // Автозапуск при загрузке
    updateDisplay();
    startCountdown();
  <\/script>
</div>
`.trim();

      document.getElementById('output').value = code;
    }

    document.getElementById('generate').addEventListener('click', generateCode);

    // сразу что-то сгенерируем по умолчанию
    generateCode();
  </script>
</body>
</html>
