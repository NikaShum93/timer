<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Таймер КГБ — редактор</title>
  <style>
    :root{
      color-scheme: dark;
    }
    *{
      box-sizing:border-box;
    }
    body{
      margin:0;
      padding:24px 24px 40px;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background:radial-gradient(circle at top, #16163b 0, #050712 55%, #02030a 100%);
      color:#f5f5ff;
    }
    h1{
      margin:0 0 4px 0;
      font-size:1.7rem;
      letter-spacing:0.08em;
      text-transform:uppercase;
      color:#f2f2ff;
      text-shadow:0 0 14px #6df2ff, 0 0 32px #4af2c5;
    }
    .subtitle{
      font-size:0.84rem;
      color:#a8b0ff;
      margin-bottom:18px;
      max-width:780px;
    }

    .layout{
      display:flex;
      gap:20px;
      align-items:flex-start;
      flex-wrap:wrap;
    }
    .panel{
      background:linear-gradient(145deg,#090c23,#131633);
      border-radius:16px;
      padding:14px 16px 16px;
      box-shadow:
        0 0 0 1px rgba(102,153,255,0.25),
        0 22px 40px rgba(0,0,0,0.65);
      position:relative;
      overflow:hidden;
    }
    .panel::before{
      content:"";
      position:absolute;
      inset:-40%;
      background:
        radial-gradient(circle at 0 0, rgba(148,255,223,0.18) 0, transparent 50%),
        radial-gradient(circle at 100% 100%, rgba(125,158,255,0.18) 0, transparent 50%);
      opacity:0.5;
      mix-blend-mode:screen;
      pointer-events:none;
    }
    .panel > *{
      position:relative;
      z-index:1;
    }

    .controls{
      width:360px;
      max-width:100%;
    }
    .controls h2,
    .preview-wrap h2,
    .output-wrap h2{
      font-size:0.96rem;
      margin:0 0 8px 0;
      color:#e0e2ff;
      letter-spacing:0.04em;
      text-transform:uppercase;
    }
    .control-group{
      margin-bottom:10px;
    }
    .control-group label{
      display:block;
      font-size:0.8rem;
      margin-bottom:4px;
    }
    .control-inline{
      display:flex;
      gap:8px;
    }
    .control-inline .control-group{
      flex:1;
      margin-bottom:0;
    }
    input[type="number"],
    input[type="text"],
    input[type="url"],
    select{
      width:100%;
      padding:6px 8px;
      border-radius:8px;
      border:1px solid #353863;
      background:#050712;
      color:#f5f5ff;
      font-size:0.85rem;
      outline:none;
      transition:border-color .16s ease, box-shadow .16s ease, background .16s ease;
    }
    input[type="number"]:focus,
    input[type="text"]:focus,
    input[type="url"]:focus,
    select:focus{
      border-color:#63f2ff;
      box-shadow:0 0 0 1px rgba(99,242,255,0.5);
      background:#040716;
    }
    input[type="color"]{
      width:100%;
      height:32px;
      padding:0;
      border-radius:8px;
      border:1px solid #353863;
      background:#050712;
      cursor:pointer;
    }
    input[type="range"]{
      width:100%;
    }
    .checkbox-row{
      display:flex;
      align-items:center;
      gap:6px;
      font-size:0.85rem;
      margin-top:4px;
    }
    button{
      width:100%;
      padding:9px 10px;
      border-radius:999px;
      border:none;
      cursor:pointer;
      font-weight:600;
      margin-top:10px;
      background:linear-gradient(135deg,#4af2c5,#63f2ff);
      color:#041013;
      box-shadow:0 0 18px rgba(74,242,197,0.55);
      letter-spacing:0.03em;
      text-transform:uppercase;
    }
    button:hover{
      filter:brightness(1.06);
      box-shadow:0 0 24px rgba(99,242,255,0.7);
    }

    .hr-soft{
      border:none;
      border-top:1px solid #262b4b;
      margin:10px 0;
    }

    .preview-wrap{
      flex:0 0 320px;
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .preview-box{
      width:320px;
      height:320px;
      background:#050712;
      border-radius:18px;
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
      overflow:hidden;
      box-shadow:
        0 0 0 1px rgba(102,153,255,0.25),
        0 20px 36px rgba(0,0,0,0.8);
    }

    .output-wrap{
      flex:1 1 380px;
      min-width:280px;
    }
    textarea{
      width:100%;
      min-height:380px;
      padding:10px;
      border-radius:12px;
      border:1px solid #353863;
      background:#050712;
      color:#f5f5ff;
      font-family:"JetBrains Mono","Fira Code",monospace;
      font-size:0.8rem;
      resize:vertical;
      outline:none;
    }
    textarea:focus{
      border-color:#63f2ff;
      box-shadow:0 0 0 1px rgba(99,242,255,0.5);
      background:#030511;
    }
    .hint{
      font-size:0.8rem;
      color:#a4a4ff;
      margin-top:6px;
    }

    /* ===== ПРЕВЬЮ ТАЙМЕРА ===== */
    .timer-preview-root{
      width:100%;
      height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .timer-preview-outer{
      position:relative;
      width:90%;
      height:90%;
      background-size:contain;
      background-repeat:no-repeat;
      background-position:center;
      overflow:visible;
    }
    .timer-preview-core{
      position:absolute;
      left:50%;
      top:50%;
      transform:translate(-50%,-50%);
      width:65%;
      aspect-ratio:1/1;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:visible;
    }
    .timer-preview-ring-wrap{
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:visible;
    }
    .timer-preview-ring-wrap svg{
      width:100%;
      height:100%;
      overflow:visible;
    }
    .timer-ring-bg{
      fill:none;
      stroke:#1e2b3a;
      opacity:0.9;
    }
    .timer-ring-fg{
      fill:none;
      stroke:#7fd7ff;
      stroke-linecap:round;
      transform-origin:50% 50%;
      transform:rotate(-90deg);
    }
    .timer-preview-time{
      position:relative;
      font-family:'Emilys Candy',cursive;
      font-size:2.8em;
      color:#e9f8ff;
      text-shadow:0 0 10px #7fd7ff,0 0 22px #7fd7ff;
      user-select:none;
      z-index:2;
    }

    /* ===== ФУТЕР ===== */
    .footer{
      margin-top:18px;
      text-align:center;
      font-size:0.8rem;
      color:#8086ff;
      letter-spacing:0.04em;
      text-transform:uppercase;
      opacity:0.9;
    }
  </style>
  <link id="preview-font-link" rel="stylesheet" />
</head>
<body>
  <h1>Таймер КГБ</h1>
  <p class="subtitle">
    Неоновый таймер для Genially: слева настраиваешь фон, шрифт, смещение,
    радиус и толщину полоски (или вовсе её отключаешь). Справа — готовый HTML для iframe.
  </p>

  <div class="layout">
    <!-- ========= НАСТРОЙКИ ========= -->
    <div class="panel controls">
      <h2>Настройки</h2>

      <div class="control-group">
        <label for="bgUrl">Фоновая картинка таймера (URL)</label>
        <input type="url" id="bgUrl"
               value="https://i.postimg.cc/28yZbpGP/Chat-GPT-Image-19-noab-2025-g-21-37-10.png">
      </div>

      <div class="control-inline">
        <div class="control-group">
          <label for="totalSeconds">Время (сек.)</label>
          <input type="number" id="totalSeconds" min="1" value="30">
        </div>
        <div class="control-group">
          <label for="fontSize">Размер цифр (em)</label>
          <input type="number" id="fontSize" step="0.1" min="1" value="2.8">
        </div>
      </div>

      <div class="control-group">
        <label for="fontName">Шрифт Google Fonts (название)</label>
        <input type="text" id="fontName" value="Emilys Candy">
      </div>

      <hr class="hr-soft">

      <div class="control-inline">
        <div class="control-group">
          <label for="offsetX">Смещение таймера (X, px)</label>
          <input type="range" id="offsetX" min="-150" max="150" value="0">
        </div>
        <div class="control-group">
          <label for="offsetY">Смещение таймера (Y, px)</label>
          <input type="range" id="offsetY" min="-150" max="150" value="0">
        </div>
      </div>

      <div class="control-inline">
        <div class="control-group">
          <label for="ringOffsetX">Смещение полоски (X, px)</label>
          <input type="range" id="ringOffsetX" min="-60" max="60" value="0">
        </div>
        <div class="control-group">
          <label for="ringOffsetY">Смещение полоски (Y, px)</label>
          <input type="range" id="ringOffsetY" min="-60" max="60" value="0">
        </div>
      </div>

      <div class="control-group checkbox-row">
        <input type="checkbox" id="ringEnabled" checked>
        <label for="ringEnabled">Показывать полоску прогресса</label>
      </div>

      <hr class="hr-soft">

      <div class="control-group">
        <label for="ringRadius">Радиус полоски (viewBox, 25–48)</label>
        <input type="range" id="ringRadius" min="25" max="48" step="0.5" value="38">
      </div>

      <div class="control-group">
        <label for="ringWidth">Толщина полоски</label>
        <input type="range" id="ringWidth" min="3" max="12" step="0.5" value="6">
      </div>

      <div class="control-inline">
        <div class="control-group">
          <label for="mainColor">Цвет неоновой полоски</label>
          <input type="color" id="mainColor" value="#7fd7ff">
        </div>
        <div class="control-group">
          <label for="trackColor">Цвет подложки полоски</label>
          <input type="color" id="trackColor" value="#1e2b3a">
        </div>
      </div>

      <div class="control-group">
        <label for="digitColor">Цвет цифр</label>
        <input type="color" id="digitColor" value="#e9f8ff">
      </div>

      <div class="control-group checkbox-row">
        <input type="checkbox" id="glowEnabled" checked>
        <label for="glowEnabled">Свечение цифр и полоски</label>
      </div>

      <button id="generateBtn">Сгенерировать HTML-код</button>
    </div>

    <!-- ========= ПРЕВЬЮ ========= -->
    <div class="preview-wrap">
      <h2>Preview</h2>
      <div class="panel preview-box">
        <div class="timer-preview-root">
          <div class="timer-preview-outer" id="preview-outer">
            <div class="timer-preview-core" id="preview-core">
              <div class="timer-preview-ring-wrap" id="preview-ring-wrap">
                <svg viewBox="0 0 100 100">
                  <circle id="preview-ring-bg" class="timer-ring-bg" cx="50" cy="50" r="38"></circle>
                  <circle id="preview-ring-fg" class="timer-ring-fg" cx="50" cy="50" r="38"></circle>
                </svg>
              </div>
              <div class="timer-preview-time" id="preview-time">0:30</div>
            </div>
          </div>
        </div>
      </div>
      <p class="hint">
        Смещение таймера двигает всё целиком. Смещение полоски — только кольцо, цифры остаются по центру.
        Чекбокс позволяет полностью скрыть полоску прогресса.
      </p>
    </div>

    <!-- ========= ВЫХОДНОЙ КОД ========= -->
    <div class="panel output-wrap">
      <h2>Готовый HTML</h2>
      <textarea id="output" spellcheck="false"></textarea>
      <p class="hint">
        Скопируй код целиком в iframe / расширение Genially. Таймер центрируется в iframe,
        масштабируется вместе с ним, а полоска при необходимости можно выключить.
      </p>
    </div>
  </div>

  <div class="footer">
    Корпорация Геймификации Будущего © 2025
  </div>

  <script>
    // ===== ЭЛЕМЕНТЫ УПРАВЛЕНИЯ =====
    const bgUrlInput        = document.getElementById('bgUrl');
    const totalSecondsInput = document.getElementById('totalSeconds');
    const fontNameInput     = document.getElementById('fontName');
    const fontSizeInput     = document.getElementById('fontSize');

    const offsetXInput      = document.getElementById('offsetX');
    const offsetYInput      = document.getElementById('offsetY');
    const ringOffsetXInput  = document.getElementById('ringOffsetX');
    const ringOffsetYInput  = document.getElementById('ringOffsetY');
    const ringEnabledInput  = document.getElementById('ringEnabled');

    const ringRadiusInput   = document.getElementById('ringRadius');
    const ringWidthInput    = document.getElementById('ringWidth');

    const mainColorInput    = document.getElementById('mainColor');
    const trackColorInput   = document.getElementById('trackColor');
    const digitColorInput   = document.getElementById('digitColor');
    const glowEnabledInput  = document.getElementById('glowEnabled');

    const previewOuter   = document.getElementById('preview-outer');
    const previewCore    = document.getElementById('preview-core');
    const previewRingWrap= document.getElementById('preview-ring-wrap');
    const previewRingBg  = document.getElementById('preview-ring-bg');
    const previewRingFg  = document.getElementById('preview-ring-fg');
    const previewTimeEl  = document.getElementById('preview-time');
    const fontLink       = document.getElementById('preview-font-link');
    const outputTextarea = document.getElementById('output');

    let previewRadius = 38;
    let previewCircumference = 2 * Math.PI * previewRadius;
    let previewTotalSeconds = 30;
    let previewRemaining = 30;
    let previewTimerId = null;

    function formatTime(sec){
      const m = Math.floor(sec/60);
      const s = sec%60;
      return `${m}:${s<10?'0':''}${s}`;
    }

    function updateFontLink(fontName){
      const f = (fontName || 'Emilys Candy').trim().replace(/\s+/g,'+');
      fontLink.href = `https://fonts.googleapis.com/css2?family=${f}&display=swap`;
    }

    function applyPreviewStyles(){
      const bgUrl       = bgUrlInput.value.trim();
      const totalSec    = parseInt(totalSecondsInput.value,10) || 30;
      const fontName    = fontNameInput.value.trim() || 'Emilys Candy';
      const fontSize    = parseFloat(fontSizeInput.value) || 2.8;
      const offsetX     = parseInt(offsetXInput.value,10) || 0;
      const offsetY     = parseInt(offsetYInput.value,10) || 0;
      const ringOffsetX = parseInt(ringOffsetXInput.value,10) || 0;
      const ringOffsetY = parseInt(ringOffsetYInput.value,10) || 0;
      const ringEnabled = ringEnabledInput.checked;
      const ringRadius  = parseFloat(ringRadiusInput.value) || 38;
      const ringWidth   = parseFloat(ringWidthInput.value) || 6;
      const mainColor   = mainColorInput.value || '#7fd7ff';
      const trackColor  = trackColorInput.value || '#1e2b3a';
      const digitColor  = digitColorInput.value || '#e9f8ff';
      const glowEnabled = glowEnabledInput.checked;

      previewTotalSeconds = totalSec;
      previewOuter.style.backgroundImage = bgUrl ? `url("${bgUrl}")` : 'none';

      // центр таймера
      previewCore.style.left = `calc(50% + ${offsetX}px)`;
      previewCore.style.top  = `calc(50% + ${offsetY}px)`;
      previewCore.style.width = '65%';

      // смещение кольца
      previewRingWrap.style.transform = `translate(${ringOffsetX}px, ${ringOffsetY}px)`;
      previewRingWrap.style.display   = ringEnabled ? 'flex' : 'none';

      // шрифт
      previewTimeEl.style.fontFamily = `'${fontName}', cursive`;
      previewTimeEl.style.fontSize   = fontSize + 'em';
      previewTimeEl.style.color      = digitColor;

      if (glowEnabled){
        previewTimeEl.style.textShadow =
          `0 0 10px ${mainColor},0 0 24px ${mainColor}`;
        previewRingFg.style.filter =
          `drop-shadow(0 0 8px ${mainColor}) drop-shadow(0 0 18px ${mainColor})`;
      } else {
        previewTimeEl.style.textShadow = 'none';
        previewRingFg.style.filter = 'none';
      }

      // кольцо
      previewRadius = ringRadius;
      previewCircumference = 2 * Math.PI * previewRadius;

      previewRingBg.setAttribute('r', ringRadius);
      previewRingFg.setAttribute('r', ringRadius);

      previewRingBg.style.stroke = trackColor;
      previewRingFg.style.stroke = mainColor;

      previewRingBg.style.strokeWidth = ringWidth;
      previewRingFg.style.strokeWidth = ringWidth;

      previewRingFg.style.strokeDasharray = previewCircumference;

      updateFontLink(fontName);
    }

    function updatePreviewRingProgress(){
      const pct = previewRemaining / previewTotalSeconds;
      const offset = previewCircumference * (1 - pct);
      previewRingFg.style.strokeDashoffset = offset;
      previewTimeEl.textContent = formatTime(previewRemaining);
    }

    function startPreviewTimer(){
      if (previewTimerId) clearInterval(previewTimerId);
      previewRemaining = previewTotalSeconds;
      updatePreviewRingProgress();
      previewTimerId = setInterval(()=>{
        if (previewRemaining <= 0){
          previewRemaining = 0;
          updatePreviewRingProgress();
          clearInterval(previewTimerId);
          previewTimerId = null;
          return;
        }
        previewRemaining--;
        updatePreviewRingProgress();
      }, 1000);
    }

    // ===== ГЕНЕРАЦИЯ КОДА ДЛЯ GENIALLY =====
    function generateCode(){
      const bgUrl       = bgUrlInput.value.trim();
      const totalSec    = parseInt(totalSecondsInput.value,10) || 30;
      const fontName    = fontNameInput.value.trim() || 'Emilys Candy';
      const fontParam   = fontName.replace(/\s+/g,'+');
      const fontSize    = parseFloat(fontSizeInput.value) || 2.8;
      const offsetX     = parseInt(offsetXInput.value,10) || 0;
      const offsetY     = parseInt(offsetYInput.value,10) || 0;
      const ringOffsetX = parseInt(ringOffsetXInput.value,10) || 0;
      const ringOffsetY = parseInt(ringOffsetYInput.value,10) || 0;
      const ringEnabled = ringEnabledInput.checked;
      const ringRadius  = parseFloat(ringRadiusInput.value) || 38;
      const ringWidth   = parseFloat(ringWidthInput.value) || 6;
      const mainColor   = mainColorInput.value || '#7fd7ff';
      const trackColor  = trackColorInput.value || '#1e2b3a';
      const digitColor  = digitColorInput.value || '#e9f8ff';
      const glowEnabled = glowEnabledInput.checked;

      const glowTextShadow = glowEnabled
        ? `text-shadow:0 0 10px ${mainColor},0 0 24px ${mainColor};`
        : `text-shadow:none;`;
      const glowFilter = glowEnabled
        ? `filter:drop-shadow(0 0 8px ${mainColor}) drop-shadow(0 0 18px ${mainColor});`
        : `filter:none;`;

      const ringVisibilityCss = ringEnabled ? '' : '.timer-ring-wrap{display:none;}';

      const code = `
<div class="card-iframe">
  <!-- Таймер КГБ — неоновая полоска -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=${fontParam}&display=swap" rel="stylesheet">

  <style>
    html,body{
      margin:0;
      padding:0;
      width:100%;
      height:100%;
      background:transparent;
      overflow:hidden;
    }
    .timer-root{
      width:100%;
      height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .timer-outer{
      position:relative;
      width:100%;
      height:100%;
      ${bgUrl ? `background-image:url("${bgUrl}");` : ''}
      background-size:contain;
      background-position:center;
      background-repeat:no-repeat;
      pointer-events:none;
      overflow:visible;
    }
    .timer-core{
      position:absolute;
      left:calc(50% + ${offsetX}px);
      top:calc(50% + ${offsetY}px);
      transform:translate(-50%,-50%);
      width:65%;
      max-width:100%;
      aspect-ratio:1/1;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:visible;
    }
    .timer-ring-wrap{
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:visible;
      transform:translate(${ringOffsetX}px, ${ringOffsetY}px);
    }
    .timer-ring-wrap svg{
      width:100%;
      height:100%;
      overflow:visible;
    }
    .timer-ring-bg{
      fill:none;
      stroke:${trackColor};
      opacity:0.9;
      stroke-width:${ringWidth};
    }
    .timer-ring-fg{
      fill:none;
      stroke:${mainColor};
      stroke-width:${ringWidth};
      stroke-linecap:round;
      transform-origin:50% 50%;
      transform:rotate(-90deg);
      ${glowFilter}
    }
    #time-display{
      position:relative;
      font-family:'${fontName}',cursive;
      font-size:${fontSize}em;
      color:${digitColor};
      ${glowTextShadow}
      user-select:none;
      z-index:2;
    }
    ${ringVisibilityCss}
  </style>

  <div class="timer-root">
    <div class="timer-outer">
      <div class="timer-core">
        <div class="timer-ring-wrap">
          <svg viewBox="0 0 100 100">
            <circle class="timer-ring-bg" cx="50" cy="50" r="${ringRadius}"></circle>
            <circle class="timer-ring-fg" id="timer-ring" cx="50" cy="50" r="${ringRadius}"></circle>
          </svg>
        </div>
        <div id="time-display">0:00</div>
      </div>
    </div>
  </div>

  <script>
    const INITIAL_TOTAL_SECONDS = ${totalSec};
    let totalSeconds = INITIAL_TOTAL_SECONDS;
    let remainingSeconds = totalSeconds;
    let timerInterval = null;

    const timeDisplay = document.getElementById('time-display');
    const ring = document.getElementById('timer-ring');

    const RADIUS = ${ringRadius};
    const CIRCUMFERENCE = 2 * Math.PI * RADIUS;
    if (ring){
      ring.style.strokeDasharray = CIRCUMFERENCE;
      ring.style.strokeDashoffset = CIRCUMFERENCE;
    }

    function formatTime(sec){
      const m = Math.floor(sec/60);
      const s = sec%60;
      return \`\${m}:\${s<10?'0':''}\${s}\`;
    }
    function updateDisplay(){
      timeDisplay.textContent = formatTime(remainingSeconds);
      if (!ring) return;
      const pct = remainingSeconds / totalSeconds;
      const offset = CIRCUMFERENCE * (1 - pct);
      ring.style.strokeDashoffset = offset;
    }

    function startCountdown(){
      clearInterval(timerInterval);
      timerInterval = setInterval(()=>{
        if (remainingSeconds <= 0){
          remainingSeconds = 0;
          updateDisplay();
          clearInterval(timerInterval);
          timerInterval = null;
          return;
        }
        remainingSeconds--;
        updateDisplay();
      }, 1000);
    }

    updateDisplay();
    startCountdown();
  <\/script>
</div>
`.trim();

      outputTextarea.value = code;
    }

    const inputs = [
      bgUrlInput,totalSecondsInput,fontNameInput,fontSizeInput,
      offsetXInput,offsetYInput,ringOffsetXInput,ringOffsetYInput,ringEnabledInput,
      ringRadiusInput,ringWidthInput,
      mainColorInput,trackColorInput,digitColorInput,glowEnabledInput
    ];
    inputs.forEach(el => {
      el.addEventListener('input', () => {
        applyPreviewStyles();
        startPreviewTimer();
        generateCode();
      });
    });
    document.getElementById('generateBtn').addEventListener('click', generateCode);

    // старт
    applyPreviewStyles();
    startPreviewTimer();
    generateCode();
  </script>
</body>
</html>
